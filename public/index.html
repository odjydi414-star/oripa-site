<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ğŸ´ æ‚ å¤§ã®ã‚ªãƒªãƒ‘æŠ½é¸ ğŸ´</title>
  <style>
    body {
      text-align: center;
      background-color: #fff;
      transition: background-color 0.5s ease;
      font-family: sans-serif;
      padding: 40px;
    }
    button {
      font-size: 20px;
      padding: 10px 20px;
      margin-top: 20px;
    }
    #status {
      font-size: 18px;
      color: #888;
      margin-top: 10px;
    }
    #result {
      font-size: 24px;
      margin-top: 20px;
    }
    img.spin {
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    body.flash {
      background-color: #ffe600;
    }
  </style>
</head>
<body>
  <h1>ğŸ´ æ‚ å¤§ã®ã‚ªãƒªãƒ‘æŠ½é¸ ğŸ´</h1>
  <p>1å›300å††ã§æŠ½é¸ã§ãã¾ã™ï¼</p>
  <button onclick="buy()">è³¼å…¥ã—ã¦æŠ½é¸ã™ã‚‹</button>
  <p id="status"></p>
  <p id="result"></p>
  <img id="cardImage" src="" alt="æŠ½é¸çµæœ" style="width:300px; margin-top:20px; display:none;">
  <audio id="hitSound" src="sounds/hit.mp3"></audio>
  <audio id="missSound" src="sounds/miss.mp3"></audio>

  <script>
    const hitImages = [
      "images/hit1.png",
      "images/hit2.png",
      "images/hit3.png"
    ];
    const missImages = [
      "images/miss1.png",
      "images/miss2.png",
      "images/miss3.png"
    ];

    async function buy() {
      const res = await fetch("/create-checkout-session", { method: "POST" });
      const data = await res.json();
      window.location.href = data.url;
    }

    // Stripeæ±ºæ¸ˆå¾Œã«å‘¼ã³å‡ºã™æŠ½é¸å‡¦ç†ï¼ˆsuccess.html ã‹ã‚‰ä½¿ã†ï¼‰
    async function drawPaid() {
      const status = document.getElementById("status");
      const result = document.getElementById("result");
      const img = document.getElementById("cardImage");
      const hitSound = document.getElementById("hitSound");
      const missSound = document.getElementById("missSound");

      status.textContent = "æŠ½é¸ä¸­...";
      result.textContent = "";
      img.style.display = "block";
      img.classList.add("spin");
      document.body.classList.remove("flash");

      const allImages = [...hitImages, ...missImages];
      let index = 0;
      const interval = setInterval(() => {
        img.src = allImages[index % allImages.length];
        index++;
      }, 100);

      setTimeout(async () => {
        clearInterval(interval);

        const res = await fetch("/paid-draw");
        const data = await res.json();

        result.textContent = `çµæœï¼š${data.name}ï¼ˆ${data.type}ï¼‰`;
        img.classList.remove("spin");

        if (data.type === "å½“ãŸã‚Š") {
          const randomHit = hitImages[Math.floor(Math.random() * hitImages.length)];
          img.src = randomHit;
          document.body.classList.add("flash");
          hitSound.play().catch(e => console.log("å½“ãŸã‚ŠéŸ³ã‚¨ãƒ©ãƒ¼:", e));
          setTimeout(() => {
            document.body.classList.remove("flash");
          }, 2000);
        } else {
          const randomMiss = missImages[Math.floor(Math.random() * missImages.length)];
          img.src = randomMiss;
          missSound.play().catch(e => console.log("ãƒã‚ºãƒ¬éŸ³ã‚¨ãƒ©ãƒ¼:", e));
        }

        status.textContent = "";
      }, 1000);
    }
  </script>
</body>
</html>